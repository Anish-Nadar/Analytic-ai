<!DOCTYPE html>
<html>
<head>
    <title>Dataset Cleaner</title>
</head>
<body>

    <h2>Upload CSV to Clean</h2>

    <form id="uploadForm">
        <input type="file" id="fileInput" accept=".csv" required />
        <br><br>
        <button type="submit">Clean Dataset</button>
    </form>

    <p id="status"></p>
    <p id="duplicates"></p>
    <p id="duplicates1"></p>

    <script>
        const form = document.getElementById("uploadForm");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const fileInput = document.getElementById("fileInput");
            const status = document.getElementById("status");
            const duplicates = document.getElementById("duplicates");
            const duplicates1 = document.getElementById("duplicates1");

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);

            status.innerText = "Cleaning dataset...";
            duplicates.innerText = "";

            const response = await fetch("/clean", {
                method: "POST",
                body: formData
            });

            // üëá Read custom header
            const dupCount = response.headers.get("X-Duplicates-Removed");

            if (response.ok) {
                duplicates1.innerText = `‚úÖ Duplicates detected: ${dupCount}`;
                duplicates.innerText = `‚úÖ Duplicates removed: ${dupCount}`;

                // Download file
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);

                const a = document.createElement("a");
                a.href = url;
                a.download = "cleaned_data.csv";
                document.body.appendChild(a);
                a.click();
                a.remove();

                status.innerText = "Cleaning complete!";
            } else {
                status.innerText = "‚ùå Error cleaning dataset";
            }
        });
    </script>

</body>
</html>